---
title: "Responses to Assignment 4"
output:
  html_notebook:
    toc: yes
    toc_float: yes
    highlight: haddock
    theme: cosmo
    number_sections: yes
  pdf_document:
    toc: yes
---

## Assignment Four: The Week Five Assignment {.unnumbered}

**`tidyr` and WIR2022**

-   Create an R Notebook of a Data Analysis containing the following and submit the rendered HTML file (e.g., `a3_123456.nb.html` by replacing 123456 with your ID)
    1.  create an R Notebook using the R Notebook Template in Moodle, save it as `a3_123456.Rmd`,
    2.  write your name and ID and the contents,
    3.  run each code block,
    4.  preview to create `a3_123456.nb.html`,
    5.  submit `a3_123456.nb.html` to Moodle.

1.  Choose data with at least two categorical variables and at least two numerical variables.

    -   Information of the data: Name, Indicator, Description, Source, etc.
    -   Explain why you chose the indicator
    -   List questions you want to study

2.  Explore the data using visualization using `ggplot2`.

    -   Create various charts
    -   Create at least one chart with at least two categorical variables and one numerical variable.
    -   Create at least one chart with at least two numerical and one categorical variable.

3.  Observations based on your data visualization and difficulties and questions encountered, if any.

**Due:** 2023-01-23 23:59:00. Submit your R Notebook file in Moodle (The Fourth Assignment). Due on Monday!

# Set up

```{r}
library(tidyverse)
library(WDI)
```

The following is useful when you use WDI.

```{r cache = TRUE, eval = FALSE}
wdi_cache <- WDIcache()
```

Or, write the cache and read it from your computer.

```{r cache = TRUE, eval = FALSE}
write_rds(wdi_cache, "./data/wdi_cache")
```

```{r cache = TRUE}
wdi_cache <- read_rds("./data/wdi_cache")
```

`WDIcache()` produces a list containing two data frames: `wdi_cache$series` and `wdi_cache$country`.

```{r}
glimpse(wdi_cache)
```

# General Comments

## Reproducibility and Literate Programming

Reproducibility and Literate Programming are critical to exploratory data analysis (EDA). These are for communication; communication with readers of the paper, graders of the assignments, and communication with yourself, as we always forget. Please think about the reader of the article, and record the procedure and output so that reader can easily understand what you have done.

The data source is critical. Unless the reader obtains the same data quickly, the communication on EDA does not start. If the data is not downloaded automatically through the code chunk, you should explain how to obtain the data and the part of the data you applied. It is crucial when you use copying and paste using `read_delim(clipboard())`. Please describe the way for the reader to retrieve the same data easily. It is best to read your paper; in some cases, it can be a hard copy from the beginning to check whether the reader can reproduce what you have done in the article.

## Varibles

In this Assignment Four, we required the following:

-   Create at least one chart with at least two categorical variables and one numerical variable.
-   Create at least one chart with at least two numerical and one categorical variable.

You can create a simple chart, such as a histogram or a box plot with only one variable. If you have two variables, you can create a scatter plot. But with `ggplot2`, you can create various charts with rich information using more than two variables. For example, the year can be used for both numerical and categorical variables using `factor(year)` or recognized as a character vector by `as.character(year)`. So the distinction between categorical variables and numerical variables is flexible. The purpose of this assignment is to experience creating a chart with rich information using more than two variables.

However, I needed to clarify the variables' requirements for some of you. So I sent out an extra message from Announcement that you do not need to take it so strictly.

If you use WDI, the following may be examples:

-   two categorical and one numerical: a. country, region, and indicator; b. country, income, and indicator; c. after selecting a couple of years and using factor(year), country, indicator, d. create a table using group_by and summarize this type, etc.
-   two numerical and one categorical: a. year, indicator, and country; b. two indicators and region, etc.

If you use WIR, the following may be examples you saw in the executive summary:

-   two categorical and one numerical: F1, F2, F4, F13 (year in this case is categorical), F15

-   two numerical and one categorical: F6, F7, F10

-   Three categorical: F3

-   Two categorical and two numerical: F8, F11

## Visualization

Data visualization is a key to EDA. Create various charts and write your observations you can or cannot obtain the chart.

The following are the first two fundamental questions you keep in mind.

-   What type of variation occurs within my variables?
-   What type of covariation occurs between my variables?

# Your Work

## Indicators Used in Assignment Three

-   NY.GDP.PCAP.KD: GDP per capita (constant 2015 US\$)
-   NY.GDP.MKTP.CD: GDP (current US\$)
-   NY.GDP.PCAP.KD.ZG: GDP per capita growth (annual%)
-   SP.POP.TOTL: Total Population
-   IP.JRN.ARTC.SC: Scientific and technical journal articles
-   FP.CPI.TOTL.ZG: Inflation, consumer prices (% annual growth)
-   DT.ODA.ODAT.PC.ZS: Net ODA received per capita (current US\$)
-   BX.KLT.DINV.CD.WD: Foreign direct investment, net inflows (BoP, current US\$)
-   MS.MIL.XPND.GD.ZS: Military expenditure (% of GDP)
-   MS.MIL.TOTL.P1: Total Armed Forces Personnel
-   SI.POV.MDIM: Multidimensional poverty headcount ratio (% of total population)
-   SI.POV.NAHC: Poverty headcount ratio at national poverty lines (% of population)
-   SI.POV.GINI: Gini index
-   NY.GNS.ICTR.ZS: Gross savings (% of GDP)
-   SL.UEM.TOTL.ZS: Unemployment, total (% of total labor force) (modeled ILO estimate)
-   SP.URB.TOTL.IN.ZS (Urban population (% of total population))
-   AG.LND.AGRI.ZS: Agricultural land (% of land area)
-   SE.ADT.LITR.FE.ZS: Literacy rate, adult female (% of females ages 15 and above))
-   SE.ADT.LITR.MA.ZS: Literacy rate, adult male (% of males ages 15 and above))
-   SE.ADT.LITR.ZS: Literacy rate, adult total
-   SE.ADT.1524.LT.FE.ZS: Literacy rate, youth female (% of females ages 15-24)
-   SE.XPD.TOTL.GD.ZS: Government expenditure on education, total (% of GDP)
-   SG.GEN.PARL.ZS: Proportion of seats held by women in national parliaments (%)

## WDIsearch

We obtain the information of the data, i.e., meta data of WDI: Name, Indicator, Description, Source, etc. by `WDIsearch`.

-   Usage

```{=html}
<!-- -->
```
    WDIsearch(string = "gdp", field = "name", short = TRUE, cache = NULL)

-   Arguments

    -   `string`: Character string. Search for this string using grep with ignore.case=TRUE.

    -   `field`: Character string. Search this field. Admissible fields: 'indicator', 'name', 'description', 'sourceDatabase', 'sourceOrganization'

    -   `short`: TRUE: Returns only the indicator's code and name. FALSE: Returns the indicator's code, name, description, and source.

    -   `cache`: Data list generated by the WDIcache function. If omitted, WDIsearch will search a local list of series.

If you follow the order of the arguments, you can omit argument names: `string`, `field`, `short`, `cache`.

-   The simplest format 1.

```{r}
WDIsearch("NY.GNS.ICTR.ZS", "indicator")
```

-   The simplest format 2.

```{r}
WDIsearch("Literacy rate", "name")
```

-   Detailed with short = FALSE

```{r}
WDIsearch("IP.JRN.ARTC.SC", "indicator", FALSE)
```

-   You can use `wdi_cache` downloaded above to use the updated meta data.

```{r}
WDIsearch("Government expenditure on education", "name", FALSE, wdi_cache)
```

## Importing Data Using WDI

-   The shortest form. The following is same as: `WDI(country = "all", indicator = "NY.GDP.PCAP.KD", start = 1960, end = NULL, extra = FALSE, cache = NULL, latest = NULL, language = "en)`

```{r}
WDI(indicator = "NY.GDP.PCAP.KD")
```

-   In order to use the downloaded data, we need to assign a name to it. It can be `df` if you download and use only one data, but it is better to assign the data to be a more descriptive name.

```{r cache = TRUE}
df_gdppcap <- WDI(indicator = "NY.GDP.PCAP.KD")
df_gdppcap
```

-   If you want to use extra information such as `region`, `income`, `lending`, use `extra = TRUE`.

```{r cache = TRUE}
df_gdppcap_extra <- WDI(indicator = "NY.GDP.PCAP.KD", extra = TRUE)
df_gdppcap_extra
```

## Writing and reading a csv file

Since the data is generally huge, it is better to use a data saved in your computer. Before saving it check whether you have `data` folder (or directory) in you project folder. Use the `Files` tab of the right bottom pane. You should be able to see the project icon with Rproj at the end, your R Notebook file you are editing, and the `data` folder. Since `.csv` is automatically added, `write_csv(gdppcap_extra, "data/gdppcap_extra")` does the same as below.

```{r eval = FALSE}
write_csv(gdppcap_extra, "data/gdppcap_extra.csv")
```

To read the data, run the next code chunk. You do not have to run the code `df_gdppcap_extra <- WDI(indicator = "NY.GDP.PCAP.KD", extra = TRUE)` again.

```{r eval = FALSE}
gdppcap <- read_csv("data/gdppcap_extra.csv")
```

"data/gdpcap_extra.csv" is the way to express the name of the data `gdpcap_extra.csv` in csv format in the data folder.

## `country` argument

If you want to import data for several countries, you can use `iso2c` codes of the countries.

```{r cache = TRUE}
ASEAN <- c("BN", "ID", "KH", "LA", "MM", "MY", "PH", "SG")
df_gdppcap_asean <- WDI(ASEAN, "NY.GDP.PCAP.KD")
df_gdppcap_asean %>% distinct(country) %>% pull()
```

```{r}
wdi_cache$country %>% filter(iso2c %in% ASEAN) %>% distinct(country) %>% pull()
```

You can also use `wdi_cache$country`.

```{r}
wdi_cache$country
```

```{r}
wdi_cache$country %>% filter(iso2c %in% ASEAN) %>% pull(country)
```

You can find iso2c codes from the downloaded data, or using wdi_cache\$country

```{r}
wdi_cache$country %>% 
  filter(country %in% c("Brunei Darussalam", "Indonesia", "Cambodia", "Lao PDR", "Myanmar", "Malaysia", "Philippines", "Singapore")) %>%
  pull(iso2c)
```

You can also find countries in some category.

```{r}
wdi_cache$country %>% 
  filter(region == "South Asia") %>%
  pull(country)
```

```{r}
wdi_cache$country %>% 
  filter(income == "Lower middle income") %>%
  pull(iso2c)
```

The following shows a list of indicators

```{r}
wdi_cache$series
```

The following is same as `WDIsearch("gdp per cap", "name")`. See WDIsearch help.

```{r}
wdi_cache$series %>% filter(grepl("gdp per cap", name, ignore.case = TRUE))
```

# Responses to Questions

## Q1. How do we use histograms.

-   [Histograms and frequency polygons](https://ggplot2.tidyverse.org/reference/geom_histogram.html)
-   [Posit Cloud: Histograms](https://posit.cloud/learn/primers/3.3)

```{r cache = TRUE}
wdi_cache$series %>% filter(indicator == "SG.GEN.PARL.ZS") %>% pull(name)
df_women_in_parl <- WDI(indicator = c(women_in_parl = "SG.GEN.PARL.ZS")) %>%
  drop_na(women_in_parl)
```

```{r}
df_women_in_parl %>% filter(year == 2020) %>%
  ggplot(aes(women_in_parl)) + geom_histogram()
```

```{r}
df_women_in_parl %>% filter(year == 2020) %>%
  ggplot(aes(women_in_parl)) + geom_histogram(binwidth = 5)
```

```{r cache = TRUE}
wdi_cache$series %>% filter(indicator == "IP.JRN.ARTC.SC") %>% pull(name)
df_stja <- WDI(indicator = c(stja = "IP.JRN.ARTC.SC"), extra = TRUE) %>%
  drop_na(stja)
```

Default of the number of bins is 30. Change and find an appropriate one.

```{r}
df_stja$year %>% summary()
```

```{r}
df_stja %>% filter(income != "Aggregates") %>% 
  ggplot(aes(stja)) + geom_histogram(bins = 20)
```

```{r}
df_stja %>% filter(income != "Aggregates", stja >0) %>% 
  ggplot(aes(stja)) + geom_histogram(bins = 20) + scale_x_log10()
```

```{r}
df_stja %>% filter(income != "Aggregates", income != "Not classified", stja >0) %>% 
  ggplot(aes(stja, fill = income)) + geom_histogram(alpha = 0.7, bins = 20, color = "black") + scale_x_log10()
```

```{r}
df_stja %>% filter(income != "Aggregates", income != "Not classified", stja >0) %>% 
  ggplot(aes(stja, fill = income)) + geom_density(alpha = 0.3) + scale_x_log10()
```

```{r cache = TRUE}
wdi_cache$series %>% filter(indicator == "MS.MIL.XPND.GD.ZS") %>% pull(name)
df_milxpnd <- WDI(indicator = c(milxpnd = "MS.MIL.XPND.GD.ZS"), extra = TRUE) %>%
  drop_na(milxpnd)
```

Default of the number of bins is 30. Here I chose binwidth = 0.5 (%).

```{r}
df_milxpnd %>% filter(income != "Aggregates", year == 2021) %>% 
  ggplot(aes(milxpnd, fill = income)) + geom_histogram(color = "black", binwidth = 0.5) + 
  labs(title = "Military expenditure (% of GDP)")
```

```{r}
df_milxpnd %>% filter(income != "Aggregates", income != "Not classified", year == 2021) %>% 
  ggplot(aes(milxpnd, fill = income)) + geom_density(binwidth = 0.5, alpha = 0.3) + 
  labs(title = "Military expenditure (% of GDP)")
```

## Q2. Effect of unemployed rate under pandemic depending on income groups

```{r cache = TRUE}
wdi_cache$series %>% filter(indicator == "SL.UEM.TOTL.ZS") %>% pull(name)
df_ur <- WDI(indicator = c(ur = "SL.UEM.TOTL.ZS"), 
             extra = TRUE, cache = wdi_cache) %>% drop_na(ur)
```

```{r}
df_ur %>% filter(income == "Aggregates") %>% filter(grepl('income', country)) %>% 
  filter(year >= 2018) %>% ggplot() + geom_line(aes(x = year, y = ur, color = country))
```

## Q3. Add values at each data point.

```{r cache = TRUE}
wdi_cache$series %>% filter(indicator == "FP.CPI.TOTL.ZG") %>% pull(name)
df_infl <- WDI(country = c("VN","CN","JP"), 
               indicator = c(inf = "FP.CPI.TOTL.ZG"), extra = TRUE) %>% drop_na(inf)
```

```{r}
df_infl_s <- df_infl %>% filter(year %in% c(2000, 2005, 2010, 2015, 2020), 
                   country %in% c("Japan", "Vietnam", "China"))
df_infl_s
```

```{r}
df_infl_s %>%
  ggplot(aes(x = year, y = inf, color= country)) + 
  geom_line() + geom_point() + 
  geom_text(aes(label = round(inf,2)), nudge_y = 0.8) + 
labs(title = "Inflation of Japan, Vietnam and China from 2000 to 2020", 
     x = "", y = "Inflation, consumer prices (annual %)")
```

# Regression Lines; Topic of EDA5

```{r cache = TRUE}
wdi_cache$series %>% filter(indicator %in% c("SI.POV.NAHC","SI.POV.MDIM")) %>% pull(name)
df_wdi_poverty <- WDI(
  indicator = c(poverty = "SI.POV.NAHC", multipoverty = "SI.POV.MDIM", gdppercap = "NY.GDP.PCAP.KD"), start = 1990,
  extra = TRUE) %>% drop_na(poverty, multipoverty, gdppercap)
```

```{r}
df_wdi_poverty %>%  
  group_by(country, year) %>%
  mutate(mean_gdp = mean(gdppercap)) %>%
  mutate(mean_poverty= mean(poverty)) %>%
  ungroup() %>% filter(income != "Aggregates") %>% 
  ggplot(aes(x = mean_gdp)) + geom_point(aes(y = mean_poverty, color = income)) +
  scale_x_log10() +  geom_smooth(aes(y = mean_poverty), formula = y~x, linetype="longdash", color = "black", method = "lm", se = FALSE) + 
  labs(x = "GDP per capita", y = "poverty rate (% of population)", title = "Poverty rates and GDP per capita", subtitle="world countries, 1990-2021 average, by income level")
```

```{r}
df_wdi_poverty %>%  
  group_by(country, year) %>%
  mutate(mean_gdp = mean(gdppercap)) %>%
  mutate(mean_multipoverty= mean(multipoverty)) %>%
  ungroup() %>%
    filter(region !="Aggregates") %>% ggplot(aes(x = mean_gdp)) + geom_point(aes(y = mean_multipoverty, color = region)) +  
  scale_x_log10() +  
  geom_smooth(aes(y = mean_multipoverty), formula = y~x, linetype="longdash", color = "black", method = "lm", se = FALSE) + labs(x = "GDP per capita", y = "Multidimentinal poverty rate (% of population)", title = "Multidimentional Poverty rates and GDP per capita", subtitle="world countries, 1990-2021 average, by region")
```

# Appendix: A secondary axis

-   [Specify a secondary axis](https://ggplot2.tidyverse.org/reference/sec_axis.html)
    -   This function is used in conjunction with a position scale to create a secondary axis, positioned opposite of the primary axis. All secondary axes must be based on a one-to-one transformation of the primary axes.

`scale_y_continuous(sec.axis = sec_axis(~ . scaling_function))`

## Example

Suppose you have two indicators,

-   NY.GDP.MKTP.KD: GDP (constant 2015 US\$)
-   NY.GDP.PCAP.KD: GDP per capita (constant 2015 US\$)

```{r}
WDIsearch(string = "NY.GDP.MKTP.KD", field = "indicator", short = FALSE, cache = wdi_cache)
```

```{r}
WDIsearch(string = "NY.GDP.PCAP.KD", field = "indicator", short = FALSE, cache = wdi_cache)
```

List the name of countries of ASEAN and BRICs using `wdi_cache$country`.

```{r}
asean <- c("Brunei Darussalam", "Cambodia", "Lao PDR", "Myanmar", 
           "Philippines", "Indonesia", "Malaysia", "Singapore")
brics <- c("Brazil", "Russian Federation", "India", "China")
```

Find the `iso2c` of the countries using `wdi_cache$country`.

```{r}
wdi_cache$country %>% 
  filter(country %in% 
           c("Brunei Darussalam", "Cambodia", "Lao PDR", "Myanmar", 
           "Philippines", "Indonesia", "Malaysia", "Singapore",
           "Brazil", "Russian Federation", "India", "China")) %>% 
  pull(iso2c)
```

Separate the iso3c's of the countries with commas and read data using `WDI`.

```{r cache=TRUE}
wdi_gdp <- WDI(
  country = c("BR", "BN", "CN", "ID", "IN", "KH", "LA", "MM", "MY", "PH", "RU", "SG"),
  indicator = c(gdp = "NY.GDP.MKTP.KD", gdpPercap = "NY.GDP.PCAP.KD"),
  start = 1960, extra = TRUE, cache = wdi_cache)
```

```{r}
wdi_gdp %>% filter(country %in% asean) %>% drop_na(gdp, gdpPercap) %>% summary() 
```

Using the summary, decide the scaling of two variables, `gdpPercap` and `gdp`.

```{r}
wdi_gdp %>% drop_na(gdp, gdpPercap) %>%
  filter(country %in% asean) %>%
  ggplot() + 
  geom_line(aes(x = year, y = gdpPercap, linetype = country)) + 
  geom_line(aes(x = year, y = gdp/(10^7), col = country)) + 
  coord_trans(x ="identity", y="log10") +
  scale_y_continuous(sec.axis = sec_axis(~ . *(10^7), name = "gdp/(10^7)"))
```

### BRICs

```{r}
wdi_gdp %>% filter(country %in% brics) %>% drop_na(gdp, gdpPercap) %>% summary() 
```

Using the summary, decide the scaling of two variables, `gdpPercap` and `gdp`.

```{r}
wdi_gdp %>% drop_na(gdp, gdpPercap) %>%
  filter(country %in% brics) %>%
  ggplot() + 
  geom_line(aes(x = year, y = gdpPercap, linetype = country)) + 
  geom_line(aes(x = year, y = gdp/(10^9), col = country)) + 
  coord_trans(x ="identity", y="log10") +
  scale_y_continuous(sec.axis = sec_axis(~ . *(10^7), name = "gdp/(10^9)"))
```
